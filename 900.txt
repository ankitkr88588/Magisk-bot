#!/bin/bash

# create .ssh folder if missing
if [ ! -d ~/.ssh ]; then
    echo Creating the ~/.ssh directory for SSH client configuration...
    mkdir ~/.ssh
else
    echo The ~/.ssh directory for SSH client configuration already exists.
fi

# create config file
echo Appending SSH connection configuration to ~/.ssh/config
cat << EOF >> ~/.ssh/config
################################################################################################
# oneAPI DevCloud SSH config
################################################################################################
Host devcloud
User u201900
IdentityFile ~/.ssh/devcloud-access-key-201900.txt
ProxyCommand ssh -T -i ~/.ssh/devcloud-access-key-201900.txt guest@ssh.devcloud.intel.com

Host devcloud.proxy
User u201900
Port 4022
IdentityFile ~/.ssh/devcloud-access-key-201900.txt
ProxyCommand ssh -T devcloud-via-proxy

# If you must route outgoing SSH connection via a corporate proxy,
# replace PROXY_HOSTNAME and PORT below with the values provided by
# your network administrator.
Host devcloud-via-proxy
User guest
Hostname ssh.devcloud.intel.com
IdentityFile ~/.ssh/devcloud-access-key-201900.txt
LocalForward 4022 c009:22
ProxyCommand nc -x PROXY_HOSTNAME:PORT %h %p
################################################################################################

################################################################################################
# DevCloud VSCode config
################################################################################################
Host devcloud-vscode
UserKnownHostsFile /dev/null
StrictHostKeyChecking no
Hostname localhost
User u201900
Port 5022
IdentityFile ~/.ssh/devcloud-access-key-201900.txt
################################################################################################

################################################################################################
# SSH Tunnel config
################################################################################################
Host *.aidevcloud
User u201900
IdentityFile ~/.ssh/devcloud-access-key-201900.txt
ProxyCommand ssh -T devcloud nc %h %p
LocalForward 5022 localhost:22
LocalForward 5901 localhost:5901
################################################################################################

EOF

# create private key file
echo Creating the private SSH key ~/.ssh/devcloud-access-key-201900.txt
echo Important: this file is your access key, keep it safe like you would a password.
cat << EOF > ~/.ssh/devcloud-access-key-201900.txt
-----BEGIN OPENSSH PRIVATE KEY-----
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
Y++y4qmmVyLjh/AAAAB3UyMDE5MDABAgM=
-----END OPENSSH PRIVATE KEY-----

EOF

# update permissions to the private key file
chmod 600 ~/.ssh/devcloud-access-key-201900.txt

echo Done! Now you can access Intel DevCloud by running 'ssh devcloud' or, if you are behind a proxy, 'ssh devcloud.proxy'
